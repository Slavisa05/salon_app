{% extends "salons/salons_base.html" %}
{% load static %}

{% block title %}
    Podesavanja profila
{% endblock title %}

{% block description %}
    Podesavanje frizerskog salona
{% endblock description %}

{% block content %}
<main>
    <section class="salons-settings-section">
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="message {{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}

        <h1>{% if salon %}Izmeni salon{% else %}Kreiraj salon{% endif %}</h1>

        {% if form.non_field_errors %}
            {{ form.non_field_errors }}
        {% endif %}

        <form class="salon-form" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="salon-form-group">
                <label for="{{ form.name.id_for_label }}">{{ form.name.label }}</label>
                {{ form.name }}
                {% if form.name.errors %}
                    {{ form.name.errors }}
                {% endif %}
            </div>

            <div class="salon-form-group">
                <label for="{{ form.description.id_for_label }}">{{ form.description.label }}</label>
                {{ form.description }}
                {% if form.description.errors %}
                    {{ form.description.errors }}
                {% endif %}
            </div>

            <div class="salon-form-group salon-form-schedule">
                <h3>Radno vreme i termini</h3>

                {% if schedule_form.non_field_errors %}
                    {{ schedule_form.non_field_errors }}
                {% endif %}

                <div class="schedule-interval-row">
                    <label for="{{ schedule_form.slot_interval_minutes.id_for_label }}">{{ schedule_form.slot_interval_minutes.label }}</label>
                    {{ schedule_form.slot_interval_minutes }}
                    {% if schedule_form.slot_interval_minutes.errors %}
                        {{ schedule_form.slot_interval_minutes.errors }}
                    {% endif %}
                </div>

                <div class="working-days-list">
                    {% for row in schedule_rows %}
                        <div class="working-day-row">
                            <label class="working-day-check">
                                {{ row.is_working }}
                                <span>{{ row.label }}</span>
                            </label>

                            <div class="working-day-times">
                                <div class="time-field-wrap">
                                    <label for="{{ row.opening_time.id_for_label }}">Od</label>
                                    {{ row.opening_time }}
                                    {% if row.opening_time.errors %}
                                        {{ row.opening_time.errors }}
                                    {% endif %}
                                </div>

                                <div class="time-field-wrap">
                                    <label for="{{ row.closing_time.id_for_label }}">Do</label>
                                    {{ row.closing_time }}
                                    {% if row.closing_time.errors %}
                                        {{ row.closing_time.errors }}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="salon-form-group salon-form-image">
                <label>{{ form.image.label }}</label>
                
                <div class="image-upload-container">
                    <!-- Preview slika -->
                    <div class="image-preview" id="image-preview">
                        {% if is_edit and salon.image %}
                            <img src="{{ salon.image.url }}" alt="{{ salon.name }}" id="preview-img">
                        {% else %}
                            <img src="{% static 'salons/img/barber_default.jpg' %}" alt="Default salon image" id="preview-img">
                        {% endif %}
                        
                        <!-- Overlay sa ikonama (pojavljuje se na hover) -->
                        <div class="image-overlay">
                            <button type="button" class="image-btn" id="change-image-btn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                    <circle cx="12" cy="13" r="4"/>
                                </svg>
                                <span>{% if is_edit %}Promeni sliku{% else %}Dodaj sliku{% endif %}</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Hidden file input -->
                    {{ form.image }}
                    
                    <!-- Info tekst -->
                    <p class="image-help-text">
                        Slika mora biti tačno 500x500 piksela. Maksimalno 5MB. Format: JPG, PNG ili WebP.
                    </p>
                    
                    {% if form.image.errors %}
                        <span class="error">{{ form.image.errors.0 }}</span>
                    {% endif %}
                </div>
            </div>

            <div class="crop-modal" id="crop-modal" aria-hidden="true">
                <div class="crop-modal-content" role="dialog" aria-modal="true" aria-labelledby="crop-modal-title">
                    <h3 id="crop-modal-title">Ispeci sliku</h3>
                    <p class="crop-modal-help">Pomerite sliku i potvrdite kvadratni crop.</p>
                    <div class="crop-image-wrapper">
                        <img id="crop-image" alt="Crop preview">
                    </div>
                    <div class="crop-modal-actions">
                        <button type="button" class="main-btn cancel-btn" id="crop-cancel-btn">Otkaži</button>
                        <button type="button" class="main-btn" id="crop-apply-btn">Primeni</button>
                    </div>
                </div>
            </div>

            <div class="salon-form-group">
                <label for="{{ form.address.id_for_label }}">{{ form.address.label }}</label>
                {{ form.address }}
                {% if form.address.errors %}
                    {{ form.address.errors }}
                {% endif %}
            </div>

            <div class="salon-form-group">
                <label for="{{ form.phone.id_for_label }}">{{ form.phone.label }}</label>
                {{ form.phone }}
                {% if form.phone.errors %}
                    {{ form.phone.errors }}
                {% endif %}
            </div>

            <div class="salon-form-actions inline-div">
                <button type="submit" class="main-btn">Sačuvaj</button>
            </div>
        </form>
    </section>
</main>
{% endblock content %}
